<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=7" />
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/libjs/ui/datepicker.css" rel="stylesheet" type="text/css" />
    <link href="/t/util/qunit/qunit.css" rel="stylesheet" type="text/css" />
    <title>量子恒道统计</title>
    <!--
        dingqiu@loader.js
    -->

    <script type="text/javascript" src="./libjs/_/loader.js"></script>
    <script type="text/javascript" src="/libjs/_/jquery-v152.js"></script>
    <script type="text/javascript" src="./t/util/qunit/qunit.js"></script>
    <script type="text/javascript" src="./t/util/common.js"></script>
</head>
<body>
<div style="height:40px;width:765px;" id="lz-boiler-plate" class="content"><div id="dpicker"></div><span id="score"></span></div>

<div>
    <h1 id="qunit-header">Date Test Suite</h1>
      <h2 id="qunit-banner"></h2>

        <div id="qunit-testrunner-toolbar"></div>
          <h2 id="qunit-userAgent"></h2>
            <ol id="qunit-tests"></ol>
            </div>
    <script type="text/javascript">
var is = equal;
require.config({
    path: '/js/?.js'
});
require.config('lib', {
    path: '/libjs/?.js'
});
require.config('olib', {
    path: '/js/lib/?.js'
});
require.config('swf', {
    path: '/swf/?.js'
});
require.config('md', {
    path: '/js/model/?.js'
});
var plan = function(obj) {
  if(obj.tests) {
    expect(obj.tests);
  }
};
        require('sammy@olib',
        'app.index',
        'lzhost',
        'date@lib',
        'lz.date@lib',
        'jquery.tmpl@lib',
        'swfobject@swf',
        'lz.util@lib',
        'jquery.util@lib',
        'lz.table@lib',
        'jemplates@olib',
        'config.config', 'base@md', function() {
        require('date');
boot();
        });

function boot() {
Date.now = function(){
    return new Date("2011-06-06");
};
require('cond.dpicker@md', function(mod) {
  var config = {
        label: 'dpicker',
        type: 'd',
        date: '-1',
        min: '-1years',
        max: '-1',
        event: function(type, start, end) {
            $('#score').html([].join.call(arguments, ','));
                //console.log('month event', arguments)
        }
    };
  var obj = mod.create(config);
  obj.run();
  $('#dpicker').append(obj.getDom());

  var picker_dom = $('#' +obj.picker_obj.id),
      picker_table = picker_dom.find('div.datepickerContainer > table table:first');
  var score = $('#score');
  var dom_m, dom_d;

  test("init day picker", 3, function(){
    is(obj.picker.val(), '2011-06-05', 'picker val');
    is(score.text(), '', 'empty score');
    is(picker_table.attr('class'), 'datepickerViewDays', 'table dom class');
  });

  test("click & open day picker", 2, function(){
    obj.picker.click();
    //alert(picker_dom.find('.datepickerMonth').text());
    dom_m = picker_table.find('thead .datepickerMonth');
    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');

    is(dom_m.text(), '2011 年 六月', 'picker dom value: year and month');
    is(dom_d.text(), '5', 'picker dom value:day');
  });

  test("click the preview day", 2, function(){
    dom_d.prev().find('a').click();
    is(obj.picker.val(), '2011-06-04', 'picker val, check again');
    is(score.text(), 'd,1307116800000,1307116800000', '2011-06-04 timestamp');
  });
  
  test("previous month day picker", 1, function(){
    obj.picker.click();
    picker_table.find('.datepickerGoPrev a').click();

    is(dom_m.text(), '2011 年 五月', 'picker dom value: year and month');
  });

  test("choic the day 05-30", 2, function(){
    picker_table.find('thead .datepickerMonth');
    //click 05-30
    picker_table.find('tbody.datepickerDays tr').eq(5).children().eq(1).find('a').click();

    is(obj.picker.val(), '2011-05-30', 'picker val, check again');
    is(score.text(), 'd,1306684800000,1306684800000', '2011-05-30 timestamp');
  });

  test("click & open day picker@0530", 2, function(){
    obj.picker.click();
    dom_m = picker_table.find('thead .datepickerMonth');
    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');

    is(dom_m.text(), '2011 年 五月', 'picker dom value: year and month');
    is(dom_d.text(), '30', 'picker dom value:day');
    obj.picker.DatePickerHide();
  });

  test("click & open day picker@0530", 5, function(){
    //set picker to week type
    obj.choice('-1', 'w');
    dom_m = picker_table.find('thead .datepickerMonth');
    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');
    is(dom_m.text(), '2011 年 五月', 'picker dom value: year and month');
    is(obj.picker.val(), '2011年22周', 'picker val, check again');
    is(score.text(), 'w,1306684800000,1307203200000', 'week, 2011-05-30 , 2011-06-05');
    is(dom_d.length, 7, 'selected element: 7')
    is(dom_d.text(), '303112345', 'selected elements text: 30 31 1 2 3 4 5')
  });
  
  test("choice day picker@0523 in week type", 5, function(){
    obj.picker.click();
    //select 05-23
    picker_table.find('tbody.datepickerDays tr').eq(4).children().eq(1).find('a').click();
    dom_m = picker_table.find('thead .datepickerMonth');
    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');
    is(dom_m.text(), '2011 年 五月', 'picker dom value: year and month');
    is(obj.picker.val(), '2011年21周', 'picker val, check again');
    is(score.text(), 'w,1306080000000,1306598400000', 'week, 2011-05-23 , 2011-05-29');
    is(dom_d.length, 7, 'selected element: 7')
    is(dom_d.text(), '23242526272829', 'selected elements text: 23 24 25 26 27 28 29')
  });


  test("choice day picker@0524 in week type", 5, function(){
    obj.picker.click();
    //click 05-24
    picker_table.find('tbody.datepickerDays tr').eq(4).children().eq(2).find('a').click();
    //hook the onShow function
    obj.setPicker();
    dom_m = picker_table.find('thead .datepickerMonth');
    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');

    is(dom_m.text(), '2011 年 五月', 'picker dom value: year and month');
    is(obj.picker.val(), '2011年21周', 'picker val, check again');
    is(score.text(), 'w,1306080000000,1306598400000', 'week, 2011-05-23 , 2011-05-29');
    is(dom_d.length, 7, 'selected element: 7');
    is(dom_d.text(), '23242526272829', 'selected elements text: 23 24 25 26 27 28 29');
  });

  test("choice week picker@20week in week type", 5, function(){
    //click 20week
    picker_table.find('tbody.datepickerDays tr').eq(3).children().eq(0).find('a').click();
    dom_m = picker_table.find('thead .datepickerMonth');
    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');

    is(dom_m.text(), '2011 年 五月', 'picker dom value: year and month');
    is(obj.picker.val(), '2011年20周', 'picker val, check again');
    is(score.text(), 'w,1305475200000,1305993600000', 'week, 2011-05-16 , 2011-05-22');
    is(dom_d.length, 7, 'selected element: 7');
    is(dom_d.text(), '16171819202122', 'selected elements text: 16 17 18 19 20 21 22');
  });



  test("click & open month picker@2011-06", 4, function(){
    //set picker to month type
    obj.choice('-1', 'm');
    obj.picker.click();
    dom_title = picker_table.find('thead .datepickerMonth');
    dom_m = picker_table.find('tbody.datepickerMonths .datepickerSelected');

    is(dom_title.text(), '2011 年', 'picker dom value: year');
    is(obj.picker.val(), '2011-06', 'picker val, check again');
    is(score.text(), 'm,1306857600000,1307203200000', 'month, 2011-06-01 , 2011-06-05');
    is(dom_m.text(), '六月', 'selected elements text: June')
  });


  test("click & open month picker@2011-05", 4, function(){
    //click month may
    picker_table.find('tbody.datepickerMonths tr').eq(1).children().eq(0).find('a').click();
    dom_title = picker_table.find('thead .datepickerMonth');
    dom_m = picker_table.find('tbody.datepickerMonths .datepickerSelected');

    is(dom_title.text(), '2011 年', 'picker dom value: year');
    is(obj.picker.val(), '2011-05', 'picker val, check again');
    is(score.text(), 'm,1304179200000,1306771200000', 'month, 2011-05-01 , 2011-05-31');
    is(dom_m.text(), '五月', 'selected elements text: May');
  });

  test("set to day again", 4, function(){
    //set picker to day type again
    obj.choice('-1', 'd');
    //obj.setPicker();
    obj.picker.click();
    dom_title = picker_table.find('thead .datepickerMonth');

    dom_d = picker_table.find('tbody.datepickerDays .datepickerSelected');

    is(dom_title.text(), '2011 年 六月', 'picker dom value: year and month');
    is(dom_d.text(), '5', 'picker dom value:day');
    is(obj.picker.val(), '2011-06-05', 'picker val, check again');
    is(score.text(), 'd,1307203200000,1307203200000', 'day, 2011-06-05 , 2011-06-05');
    obj.picker.DatePickerHide();
  });
  /*
  setTimeout(function(){
    alert(1);
    obj.choice('-1', 'd');
    obj.getDom().find('.timer_input').click();
  }, 2000);
  */
});
}
    </script>
</body>
</html>
